<!DOCTYPE HTML>
<html lang="ru">
<head>
	<title>Пакуйте чемоданы. Грузите апельсины.</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=792, user-scalable=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<link rel="stylesheet" href="shower/themes/bright/styles/screen.css">
	<link rel="stylesheet" href="assets/styles.css">
</head>
<body class="list">

<header class="caption">
	<h1>Пакуйте чемоданы. Грузите апельсины.</h1>

	<p>Владимир Кузнецов, Graph</p>
</header>

<section class="slide intro">
	<div>
		<h2>Пакуйте чемоданы.<br>Грузите апельсины.</h2>

		<p>Владимир Кузнецов, Graph</p>

		<p>FrontendConf 2015, Москва</p>
	</div>
</section>

<section class="slide">
	<div>
		<h2>План</h2>
		<ol>
			<li>Модули в JavaScript — CommonJS, AMD, UMD</li>
			<li>Репозитории модулей — npm и Bower</li>
			<li>Инструменты для упаковки модулей:
				<ul>
					<li>Browserify</li>
					<li>Webpack</li>
				</ul>
			</li>
		</ol>
	</div>
</section>

<section class="slide shout"><div>
	<h2>Модульный код</h2>
</div></section>

<section class="slide"><div>
	<h2>Immediately invoked function expression</h2>
	<pre>
		<code>(function () {</code>
		<code>  /* some useful code here */ } </code>
		<code>}());</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Immediately invoked function expression</h2>
	<pre>
		<code>var FooBarModule = (function () {</code>
		<code>  return {</code>
		<code>    foo: function () { /* some useful code here */ },</code>
		<code>    bar: function () { /* more code here */ } </code>
		<code>  };</code>
		<code>}());</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Плагины jQuery</h2>
	<pre>
		<code>jQuery.fn.foobar = function (options) {</code>
		<code>  return this.each(function () {</code>
		<code>    // plug-in code here</code>
		<code>  });</code>
		<code>};</code>
	</pre>
</div></section>

<section class="slide shout"><div>
	<h2>
		Все знают как использовать плагины jQuery!
	</h2>
</div></section>

<section class="slide"><div>
	<h2>Плюсы модульного кода</h2>
	<ul>
		<li class="next">не захламняем глобальные перменные;</li>
		<li class="next">каждый модуль предоставляет API для работы с ним;</li>
		<li class="next">код приложения становится удобно обслуживать.</li>
	</ul>
</div></section>

<section class="slide shout"><div>
	<h2>Порядок подключения отдельных фрагментов кода</h2>
</div></section>

<section class="slide"><div>
	<h2>Раньше делали так:</h2>
	<pre>
		<code>&lt;script src=&quot;jquery.js&quot;&gt;&lt;/script&gt;</code>
		<code>&lt;script src=&quot;plugin1.js&quot;&gt;&lt;/script&gt;</code>
		<code>&lt;script src=&quot;plugin2.js&quot;&gt;&lt;/script&gt;</code>
		<code>&lt;script src=&quot;plugin3.js&quot;&gt;&lt;/script&gt;</code>
		<code>&lt;script src=&quot;init.js&quot;&gt;&lt;/script&gt;</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Потом стали делать так:</h2>
	<pre>
		<code>&lt;script src=&quot;bundle.js&quot;&gt;&lt;/script&gt;</code>
	</pre>
	<pre>
		<code>$ cat jquery.js \</code>
		<code>  plugin1.js plugin2.js plugin3.js \</code>
		<code>  init.js \</code>
		<code>    &gt; bundle.js</code>
	</pre>
</div></section>

<section class="slide shout"><div>
	<h2>Проблема: определять порядок автоматически</h2>
</div></section>

<section class="slide"><div>
	<h2>Конфигурация зависимостей модулей</h2>
	<ul>
		<li>Dojo</li>
		<li>YUI</li>
		<li>Самоделки <span class="next">(Например,
			<a href="https://github.com/mistakster/app-skeleton" target="_blank">https://github.com/mistakster/app-skeleton</a>)</span></li>
	</ul>
</div></section>

<section class="slide"><div>
	<h2>Дерево зависимостей</h2>
	<div class="col2-left">
		<pre class="pre">
			<code>jquery</code>
			<code>backbone</code>
			<code><span class="fade">├─</span> jquery</code>
			<code><span class="fade">└─</span> underscore</code>
			<code>item-list</code>
			<code><span class="fade">└─</span> backbone</code>
			<code>search-widget</code>
			<code><span class="fade">└─</span> autocomplete</code>
			<code>   <span class="fade">└─</span> jquery</code>
		</pre>
	</div>
	<div class="col2-right next">
		<pre class="pre">
			<code>jquery</code>
			<code>underscore</code>
			<code>backbone</code>
			<code>item-list</code>
			<code>autocomplete</code>
			<code>search-widget</code>
		</pre>
	</div>
</div></section>

<section class="slide shout"><div>
	<h2>Форматы модулей</h2>
</div></section>

<section class="slide"><div>
	<h2>CommonJS</h2>
	<p><a href="http://wiki.commonjs.org/wiki/Modules" target="_blank">http://wiki.commonjs.org/wiki/Modules</a></p>
	<ol class="next">
		<li>Функция <code>require</code></li>
		<li>Объект <code>exports</code></li>
		<li>Объект <code>module</code></li>
	</ol>
</div></section>

<section class="slide"><div>
	<h2>Пример CommonJS-модуля</h2>
	<pre>
		<code><span class="fade">/* dictionary.js */</span></code>
		<code>exports.hello = 'Hello World!';</code>
	</pre>
	<pre>
		<code><span class="fade">/* app.js */</span></code>
		<code>var dictionary = require('./dictionary.js');</code>
		<code><span class="fade">// dictionary == {&quot;hello&quot;: &quot;Hello World!&quot;};</span></code>
		<code>console.log(dictionary.hello);</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Пример CommonJS-модуля</h2>
	<pre>
		<code><span class="fade">/* dictionary.js */</span></code>
		<code><mark class="important">exports</mark>.hello = 'Hello World!';</code>
	</pre>
	<pre>
		<code><span class="fade">/* app.js */</span></code>
		<code>var dictionary = <mark class="important">require</mark>('./dictionary.js');</code>
		<code><span class="fade">// dictionary == {&quot;hello&quot;: &quot;Hello World!&quot;};</span></code>
		<code>console.log(dictionary.hello);</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Особенности CommonJS-модуля</h2>
	<p>Формат разрабатывался исключительно для выполнения на сервере или внутри приложения.</p>
	<ul class="next">
		<li>один файл &mdash; один модуль;</li>
		<li class="next">синхронная загрузка модулей;</li>
		<li class="next">код модулей не может быть исполнен в браузере без модификаций.</li>
	</ul>
</div></section>

<section class="slide"><div>
	<h2>AMD (Asynchronous Module Definition)</h2>
	<p><a href="https://github.com/amdjs/amdjs-api" target="_blank">https://github.com/amdjs/amdjs-api</a></p>
	<ol class="next">
		<li>Функция <code>define</code></li>
		<li class="next">Поле <code>define.amd</code> &mdash; объект</li>
	</ol>
</div></section>

<section class="slide"><div>
	<h2>Пример AMD-модуля</h2>
	<pre>
		<code>define('dictionary', {</code>
		<code>  hello: 'Hello World!';</code>
		<code>});</code>
	</pre>
	<pre>
		<code>define('app', ['dictionary'], function (dictionary) {</code>
		<code>  console.log(dictionary.hello);</code>
		<code>});</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Специальные зависимости</h2>
	<ol>
		<li>Функция <code>require</code></li>
		<li>Объект <code>exports</code></li>
		<li>Объект <code>module</code></li>
	</ol>
</div></section>

<section class="slide"><div>
	<h2>AMD используется как обёртка для CommonJS</h2>
	<pre>
		<code>define(['require', 'exports', 'module'],</code>
		<code>    function (require, exports, module) {</code>
		<code>  var foo = require('foo'),</code>
		<code>  exports.bar = function () {};</code>
		<code>});</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Особенности AMD-модуля</h2>
	<ul>
		<li>код может исполнятся в браузере без модификаций;</li>
		<li>возможна асинхронная загрузка модулей;</li>
		<li>модуль может зависеть от данных любых типов&nbsp;&mdash;<br>текст, шаблоны, стили и т.п.</li>
	</ul>
</div></section>

<section class="slide"><div>
	<h2>UMD (Universal Module Definition)</h2>
	<p><a href="https://github.com/umdjs/umd" target="_blank">https://github.com/umdjs/umd</a></p>
	<p>Универсальная обёртка, которая в зависимости от окружения экспортирует модуль
		как CommonJS или как AMD.</p>
</div></section>

<section class="slide shout"><div>
	<h2>Browserify</h2>
</div></section>

<section class="slide"><div>
	<h2>Browserify</h2>
	<pre>
		<code>$ browserify main.js > bundle.js</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Browserify</h2>
	<p>Трансформации:</p>
	<ul>
		<li>другие языки и диалекты;</li>
		<li>шаблоны;</li>
		<li>внедрение статических файлов;</li>
		<li>использование «не модульного» кода.</li>
	</ul>
</div></section>

<section class="slide"><div>
	<h2>CoffeeScript</h2>
	<pre>
		<code>$ browserify -t <mark class="important">coffeeify</mark> main.coffee > bundle.js</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>ECMAScript 2015 и JSX</h2>
	<pre>
		<code>$ browserify -t <mark class="important">babelify</mark> main.jsx > bundle.js</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Шаблоны Handlebars</h2>
	<pre>
		<code>/* main.js */</code>
		<code>var template = require('./view.hbs');</code>
		<code>var html = template({title: "Hello World!"});</code>
	</pre>
	<pre>
		<code>$ browserify -t <mark class="important">browserify-handlebars</mark> main.js > bundle.js</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Статические файлы</h2>
	<pre>
		<code><span class="fade">/* main.js */</span></code>
		<code>var fs = require('fs');</code>
		<code>var text = fs.readFileSync(</code>
		<code>  __dirname + '/data.txt', 'utf8'</code>
		<code>);</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Статические файлы</h2>
	<pre>
		<code>$ browserify -t <mark class="important">brfs</mark> main.js > bundle.js</code>
	</pre>
	<pre>
		<code><span class="fade">/* bundle.js */</span></code>
		<code>var text = "Hello World!";</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Использование вместе с&nbsp;&laquo;не&nbsp;модульным&raquo; кодом</h2>
	<pre>
		<code>&quot;browser&quot;: {</code>
		<code>  &quot;bootstrap&quot;: &quot;./assets/js/bootstrap.js&quot;</code>
		<code>},</code>
		<code>&quot;browserify-shim&quot;: {</code>
		<code>  &quot;bootstrap&quot;: {&quot;depends&quot;: [&quot;jquery&quot;]}</code>
		<code>}</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Использование вместе с&nbsp;&laquo;не&nbsp;модульным&raquo; кодом</h2>
	<pre>
		<code>/* main.js */</code>
		<code>require('bootstrap');</code>
	</pre>
	<p>В упаковку автоматически будут добавлены все модули,
		которые были перечислены в конфигурации</p>
</div></section>

<section class="slide"><div>
	<h2>Использование вместе с&nbsp;&laquo;не&nbsp;модульным&raquo; кодом</h2>
	<p>Если грузим jQuery из CDN, то упаковывать её не нужно.</p>
	<pre>
		<code>&quot;browserify-shim&quot;: {</code>
		<code>  &quot;jquery&quot;: {&quot;exports&quot;: &quot;global:$&quot;}</code>
		<code>}</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Ручное управление</h2>
	<ul>
		<li>Главная страница</li>
		<li>Контентные страницы</li>
		<li>«Админка»</li>
	</ul>
	<p>Общие для всех разделов модули можно вынести в отдельную упаковку.</p>
</div></section>

<section class="slide"><div>
	<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 228 148"
			style="width: 100%; height: 420px;">
		<rect x="2" y="82" fill="#FFFFFF" stroke="#000000" stroke-miterlimit="10" width="64" height="64"/>
		<text transform="matrix(1 0 0 1 10.0005 96)" font-size="10">main.js</text>
		<rect x="82" y="82" fill="#FFFFFF" stroke="#000000" stroke-miterlimit="10" width="64" height="64"/>
		<rect x="162.001" y="82" fill="#FFFFFF" stroke="#000000" stroke-miterlimit="10" width="64" height="64"/>
		<text transform="matrix(1 0 0 1 90.0005 96)" font-size="10">content.js</text>
		<text transform="matrix(1 0 0 1 170.0005 96)" font-size="10">admin.js</text>
		<rect x="2" y="2" fill="#FFFFFF" stroke="#000000" stroke-miterlimit="10" width="224" height="64"/>
		<rect x="10" y="26" fill="#FFFFFF" stroke="#000000" stroke-miterlimit="10" width="64" height="32"/>
		<rect x="82" y="26" fill="#FFFFFF" stroke="#000000" stroke-miterlimit="10" width="64" height="32"/>
		<rect x="154" y="26" fill="#FFFFFF" stroke="#000000" stroke-miterlimit="10" width="64" height="32"/>
		<text transform="matrix(1 0 0 1 10.0005 16)" font-size="10">bundle.js</text>
		<text x="42" y="45" text-anchor="middle" font-size="10">jquery</text>
		<text x="114" y="45" text-anchor="middle" font-size="10">backbone</text>
		<text x="186" y="45" text-anchor="middle" font-size="10">underscore</text>
	</svg>
</div></section>

<section class="slide"><div>
	<h2>Упаковка с общими модулями</h2>
	<pre>
		<code>$ browserify \</code>
		<code>  -r jquery -r backbone -r underscore \</code>
		<code>  > libs.js</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Упаковка для каждого раздела</h2>
	<pre>
		<code>$ LIBS="-x jquery -x backbone -x underscore"</code>
		<code>$ browserify $LIBS main.js > main.bundle.js</code>
		<code>$ browserify $LIBS content.js > content.bundle.js</code>
		<code>$ browserify $LIBS admin.js > admin.bundle.js</code>
	</pre>
</div></section>

<section class="slide"><div>
	<h2>Watchify</h2>
	<pre>
		<code>$ watchify main.js -o bundle.js</code>
	</pre>
</div></section>


<div class="progress">
	<div></div>
</div>
<script src="shower/shower.min.js"></script>
<!-- Copyright © 2015 Владимир Кузнецов -->
</body>
</html>